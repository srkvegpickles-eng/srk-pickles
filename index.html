<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SRK Pickles – Orders & Tracking</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#fffdf7;--accent:#0f5b4f;--accent-2:#c0392b;--muted:#7a6a60}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial; margin:0; background:var(--bg); color:#222}
    header{display:flex;align-items:center;gap:16px;padding:12px 16px;background:linear-gradient(90deg,#fff7f1,#fffefc);position:sticky;top:0;z-index:50;border-bottom:1px solid #eee}
    .brand{font-weight:800;color:var(--accent);font-size:20px}
    nav{margin-left:16px;display:flex;gap:8px}
    nav button{background:#fff;border:1px solid #e6dcd1;padding:8px 10px;border-radius:999px;cursor:pointer}
    .actions{margin-left:auto;display:flex;gap:8px;align-items:center}
    .btn{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}
    .btn.secondary{background:#f3e6dd;color:#4d3825}
    main{max-width:980px;margin:20px auto;padding:0 16px}
    .card{background:#fff;padding:14px;border-radius:12px;border:1px solid #efe7df;margin-bottom:12px}
    .muted{color:var(--muted);font-size:13px}
    .orders-grid{display:grid;gap:10px}
    .order-row{border:1px dashed #eee;padding:10px;border-radius:10px;background:#fffdf9}
    .order-id{font-weight:700;color:var(--accent)}
    .status-pill{display:inline-block;padding:6px 8px;border-radius:999px;font-size:13px}
    .status-placed{background:#fff3d6;color:#8b4b0f;border:1px solid #f4cf84}
    .status-packed{background:#e6fff5;color:#0f5b4f;border:1px solid #9de0c0}
    .status-shipped{background:#e7f0ff;color:#0f3b8a;border:1px solid #c7d9ff}
    .status-otd{background:#fff4f0;color:#ad3b2c;border:1px solid #f5c9be}
    .status-delivered{background:#e7ffe9;color:#0b6b2d;border:1px solid #bfe8c1}
    .timeline{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
    .small{font-size:13px;color:#666}
    input[type="text"], input[type="tel"]{padding:8px;border-radius:8px;border:1px solid #e6dcd1;width:100%}
    .flex{display:flex;gap:8px;align-items:center}
    .col{flex:1}
    .note{font-size:13px;color:#7a6a60;margin-top:8px}
    .link{color:var(--accent-2);text-decoration:underline;cursor:pointer}
    footer{padding:20px;text-align:center;color:#8b6f5a;font-size:13px}
    @media(max-width:600px){ header{flex-wrap:wrap} .actions{width:100%;justify-content:space-between} }
  </style>
</head>
<body>
<header>
  <div class="brand">SRK Pickles</div>
  <nav>
    <button id="nav-shop">Shop</button>
    <button id="nav-orders">My Orders</button>
    <button id="nav-contact">Contact</button>
  </nav>
  <div class="actions">
    <div class="muted">WhatsApp: <a href="https://wa.me/917075535180" target="_blank">+91 70755 35180</a></div>
    <button class="btn" id="btn-open-cart">Cart</button>
  </div>
</header>

<main id="main">
  <section id="shop-section" class="card">
    <h2>Welcome — Shop Pickles</h2>
    <p class="muted">This demo contains limited products. Add items to cart and place an order. Orders are saved locally; customers can view order history by phone number and track updates here.</p>

    <div id="products" class="orders-grid"></div>
  </section>

  <section id="orders-section" class="card" style="display:none;">
    <h2>My Orders</h2>
    <p class="muted">Enter the phone number you used while placing orders to view order history and tracking updates.</p>

    <div class="flex" style="margin-top:8px;">
      <input type="tel" id="lookup-phone" placeholder="Enter phone number (e.g., 7075535180)" />
      <button class="btn" id="lookup-btn">Lookup</button>
    </div>

    <div id="orders-list" style="margin-top:12px;"></div>

    <div class="note">Orders shown here are stored locally in your browser for this demo. To sync across devices, we can connect a backend (Google Sheets, Firebase, or a small server).</div>
  </section>

  <section id="contact-section" class="card" style="display:none;">
    <h2>Contact & Support</h2>
    <p class="muted">For live support use WhatsApp or call. In a production site we'd connect real-time updates (SMS/WhatsApp) and courier tracking APIs.</p>
    <p>WhatsApp: <a href="https://wa.me/917075535180" target="_blank">+91 70755 35180</a></p>
  </section>
</main>

<footer>© SRK Pickles • Demo orders saved in browser (localStorage)</footer>

<script>
/* ======= Simple product set for demo ======= */
const PRODUCTS = [
  { id: "mango-garlic", name: "Mango Pickle (With Garlic)", price500: 350, price1000: 700 },
  { id: "gongura", name: "Gongura Pickle", price500: 350, price1000: 700 },
  { id: "bellam-avakaya", name: "Bellam Avakaya", price500: 400, price1000: 800 }
];

const ORDERS_KEY = "srk_orders_demo_v1";
let CART = [];

/* ======= UI render ======= */
function renderProducts() {
  const el = document.getElementById("products");
  el.innerHTML = "";
  PRODUCTS.forEach(p => {
    const row = document.createElement("div");
    row.className = "order-row";
    row.innerHTML = `
      <div style="display:flex;gap:12px;align-items:center">
        <div style="flex:1">
          <div style="font-weight:700">${p.name}</div>
          <div class="small muted">500g: Rs.${p.price500} • 1kg: Rs.${p.price1000}</div>
        </div>
        <div style="width:220px">
          <div style="display:flex;gap:6px;margin-bottom:6px">
            <select data-pid="${p.id}" class="size-select" style="flex:1;padding:8px;border-radius:8px;border:1px solid #e6dcd1">
              <option value="500">500g</option>
              <option value="1000">1kg</option>
            </select>
            <input type="number" min="1" value="1" class="qty-input" style="width:70px;padding:8px;border-radius:8px;border:1px solid #e6dcd1" />
          </div>
          <div style="display:flex;gap:6px">
            <button class="btn add-btn" data-id="${p.id}">Add to cart</button>
            <button class="btn secondary buy-now" data-id="${p.id}">Buy now</button>
          </div>
        </div>
      </div>
    `;
    el.appendChild(row);
  });

  // wire up buttons
  document.querySelectorAll(".add-btn").forEach(b => b.addEventListener("click", e => {
    const id = e.currentTarget.getAttribute("data-id");
    const container = e.currentTarget.closest(".order-row");
    const size = container.querySelector(".size-select").value;
    const qty = parseInt(container.querySelector(".qty-input").value, 10) || 1;
    const prod = PRODUCTS.find(x => x.id === id);
    const unit = size === "500" ? prod.price500 : prod.price1000;
    CART.push({ id: id, name: prod.name, size: size, qty: qty, unitPrice: unit });
    alert("Added to cart: " + prod.name);
  }));

  document.querySelectorAll(".buy-now").forEach(b => b.addEventListener("click", e => {
    const id = e.currentTarget.getAttribute("data-id");
    const container = e.currentTarget.closest(".order-row");
    const size = container.querySelector(".size-select").value;
    const qty = parseInt(container.querySelector(".qty-input").value, 10) || 1;
    const prod = PRODUCTS.find(x => x.id === id);
    const unit = size === "500" ? prod.price500 : prod.price1000;
    const tempCart = [{ id: id, name: prod.name, size: size, qty: qty, unitPrice: unit }];
    openCheckoutModal(tempCart);
  }));
}

/* ======= Checkout modal (simple prompt flow) ======= */
function openCheckoutModal(cartForCheckout) {
  // simple form prompts for demo – in a real site you'd show a modal form
  const name = prompt("Enter name for order:");
  if (!name) return alert("Order cancelled");
  const phone = prompt("Enter phone number (used to track order):");
  if (!phone) return alert("Order cancelled");
  const addr = prompt("Enter delivery address:");
  if (!addr) return alert("Order cancelled");
  // calculate totals
  let subtotal = 0;
  cartForCheckout.forEach(i => subtotal += i.unitPrice * i.qty);
  const delivery = subtotal >= 1200 ? 0 : 80;
  const order = {
    id: "SRK" + Date.now().toString().slice(-6),
    name, phone, addr, items: cartForCheckout, subtotal, delivery,
    total: subtotal + delivery, createdAt: new Date().toISOString(),
    statusHistory: [{ status: "Order Placed", time: new Date().toISOString() }]
  };
  saveOrder(order);
  // simulate sending to WhatsApp by opening wa link with summary
  const summary = cartForCheckout.map(i => `${i.name} (${i.size}) x${i.qty} = Rs.${i.unitPrice*i.qty}`).join("%0A");
  const msg = `New SRK Pickles Order%0A%0AName: ${encodeURIComponent(name)}%0APhone: ${encodeURIComponent(phone)}%0AAddress: ${encodeURIComponent(addr)}%0A%0AItems:%0A${summary}%0A%0ATotal: Rs.${order.total}`;
  window.open("https://wa.me/917075535180?text=" + msg, "_blank");
  alert("Order placed! Your Order ID: " + order.id + ". Use My Orders → Lookup to view tracking updates.");
  // start simulated tracking progress in background (local only)
  simulateOrderProgress(order.id);
}

/* ======= Orders storage & lookup ======= */
function getStoredOrders() {
  try { return JSON.parse(localStorage.getItem(ORDERS_KEY) || "[]"); }
  catch(e) { return []; }
}
function saveOrder(order) {
  const arr = getStoredOrders();
  arr.unshift(order);
  localStorage.setItem(ORDERS_KEY, JSON.stringify(arr));
}
function findOrdersByPhone(phone) {
  if (!phone) return [];
  const arr = getStoredOrders();
  return arr.filter(o => (o.phone || "").replace(/\D/g, "").endsWith(phone.replace(/\D/g, "")));
}

/* ======= Render orders list for lookup ======= */
function renderOrdersListForPhone(phone) {
  const container = document.getElementById("orders-list");
  container.innerHTML = "";
  const list = findOrdersByPhone(phone || "");
  if (!list.length) { container.innerHTML = "<div class='muted'>No orders found for this number.</div>"; return; }
  list.forEach(order => {
    const div = document.createElement("div");
    div.className = "order-row";
    div.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="order-id">Order: ${order.id}</div>
          <div class="small muted">Placed: ${new Date(order.createdAt).toLocaleString()}</div>
        </div>
        <div style="text-align:right">
          <div style="font-weight:800">Rs.${order.total}</div>
          <div class="small muted">${order.items.length} item(s)</div>
        </div>
      </div>
      <div style="margin-top:8px">${order.items.map(it => `<div class="small">${it.name} • ${it.size} • x${it.qty} • Rs.${it.unitPrice*it.qty}</div>`).join("")}</div>
      <div class="timeline" id="timeline-${order.id}"></div>
      <div style="margin-top:8px;display:flex;gap:8px;justify-content:flex-end;align-items:center">
        <button class="btn secondary" onclick="showTrackingLink('${order.id}')">Courier Link</button>
        <button class="btn" onclick="copyOrderId('${order.id}')">Copy Order ID</button>
      </div>
    `;
    container.appendChild(div);
    renderOrderTimeline(order);
  });
}

/* Render timeline for an order (statusHistory) */
function renderOrderTimeline(order) {
  const t = document.getElementById("timeline-" + order.id);
  if (!t) return;
  t.innerHTML = "";
  const history = order.statusHistory || [];
  history.forEach(h => {
    const span = document.createElement("div");
    span.className = "status-pill " + statusClass(h.status);
    span.innerHTML = `<strong style="font-weight:700">${h.status}</strong><div class="small" style="margin-top:4px">${new Date(h.time).toLocaleString()}</div>`;
    t.appendChild(span);
  });
}

/* Map status to class */
function statusClass(status) {
  if (status === "Order Placed") return "status-placed";
  if (status === "Packed") return "status-packed";
  if (status === "Shipped") return "status-shipped";
  if (status === "Out for Delivery") return "status-otd";
  if (status === "Delivered") return "status-delivered";
  return "";
}

/* Simulate background progression of order status for demo (local only) */
function simulateOrderProgress(orderId) {
  // find and update stored order with delays (short for demo)
  const steps = ["Packed", "Shipped", "Out for Delivery", "Delivered"];
  let delay = 5000; // 5s initial delay before first update for demo
  steps.forEach((s, idx) => {
    setTimeout(() => {
      const arr = getStoredOrders();
      const order = arr.find(o => o.id === orderId);
      if (!order) return;
      order.statusHistory.push({ status: s, time: new Date().toISOString() });
      localStorage.setItem(ORDERS_KEY, JSON.stringify(arr));
      // If the orders list is currently showing this phone, re-render timelines
      const lookupPhone = document.getElementById("lookup-phone").value || "";
      if (lookupPhone && findOrdersByPhone(lookupPhone).some(o => o.id === orderId)) {
        renderOrdersListForPhone(lookupPhone);
      }
    }, delay * (idx + 1));
  });
}

/* Show a fake courier link (demo) */
function showTrackingLink(orderId) {
  const url = "https://www.example.com/track?order=" + encodeURIComponent(orderId);
  window.open(url, "_blank");
}

/* Copy order id to clipboard */
function copyOrderId(id) {
  navigator.clipboard && navigator.clipboard.writeText(id);
  alert("Order ID copied: " + id);
}

/* ======= Navigation wiring ======= */
document.getElementById("nav-shop").addEventListener("click", function(){
  document.getElementById("shop-section").style.display = ""; document.getElementById("orders-section").style.display = "none"; document.getElementById("contact-section").style.display = "none";
});
document.getElementById("nav-orders").addEventListener("click", function(){
  document.getElementById("shop-section").style.display = "none"; document.getElementById("orders-section").style.display = ""; document.getElementById("contact-section").style.display = "none";
});
document.getElementById("nav-contact").addEventListener("click", function(){
  document.getElementById("shop-section").style.display = "none"; document.getElementById("orders-section").style.display = "none"; document.getElementById("contact-section").style.display = "";
});

/* Lookup button */
document.getElementById("lookup-btn").addEventListener("click", function(){
  const phone = (document.getElementById("lookup-phone").value || "").trim();
  if(!phone){ alert("Enter phone number to lookup orders"); return; }
  renderOrdersListForPhone(phone);
});

/* Cart button opens basic checkout for cart */
document.getElementById("btn-open-cart").addEventListener("click", function(){
  if(!CART.length){ alert("Cart is empty. Add items first."); return; }
  openCheckoutModal(CART);
  CART = []; // clear cart after attempting checkout
});

/* Init demo products */
renderProducts();

/* For demo: pre-seed one order if none present */
if(!getStoredOrders().length){
  const sample = {
    id: "SRK999001",
    name: "Sample Customer",
    phone: "7075535180",
    addr: "Demo Address",
    items: [{ id:"mango-garlic", name:"Mango Pickle (With Garlic)", size:"500", qty:1, unitPrice:350 }],
    subtotal: 350, delivery: 80, total: 430, createdAt: new Date().toISOString(),
    statusHistory: [{ status:"Order Placed", time: new Date().toISOString() }]
  };
  saveOrder(sample);
  // simulate progress slowly so users can see updates
  setTimeout(()=>simulateOrderProgress(sample.id), 4000);
}

</script>
</body>
</html>
