<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SRK Pickles – Orders, Tracking, Admin & Notifications</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="robots" content="noindex">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#fffdf7;--accent:#0f5b4f;--accent-2:#c0392b;--muted:#7a6a60}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;background:var(--bg);color:#222}
    header{display:flex;align-items:center;gap:16px;padding:12px 16px;background:linear-gradient(90deg,#fff7f1,#fffefc);position:sticky;top:0;z-index:50;border-bottom:1px solid #eee}
    .brand{font-weight:800;color:var(--accent);font-size:20px}
    nav{margin-left:16px;display:flex;gap:8px}
    nav button{background:#fff;border:1px solid #e6dcd1;padding:8px 10px;border-radius:999px;cursor:pointer}
    .actions{margin-left:auto;display:flex;gap:8px;align-items:center}
    .btn{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}
    .btn.secondary{background:#f3e6dd;color:#4d3825}
    main{max-width:1100px;margin:20px auto;padding:0 16px}
    .card{background:#fff;padding:14px;border-radius:12px;border:1px solid #efe7df;margin-bottom:12px}
    .muted{color:var(--muted);font-size:13px}
    .orders-grid{display:grid;gap:10px}
    .order-row{border:1px dashed #eee;padding:10px;border-radius:10px;background:#fffdf9}
    .order-id{font-weight:700;color:var(--accent)}
    .status-pill{display:inline-block;padding:6px 8px;border-radius:999px;font-size:13px}
    .status-placed{background:#fff3d6;color:#8b4b0f;border:1px solid #f4cf84}
    .status-packed{background:#e6fff5;color:#0f5b4f;border:1px solid #9de0c0}
    .status-shipped{background:#e7f0ff;color:#0f3b8a;border:1px solid:#c7d9ff'}
    .status-otd{background:#fff4f0;color:#ad3b2c;border:1px solid #f5c9be}
    .status-delivered{background:#e7ffe9;color:#0b6b2d;border:1px solid #bfe8c1}
    .timeline{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
    .small{font-size:13px;color:#666}
    input[type="text"], input[type="tel"], input[type="password"]{padding:8px;border-radius:8px;border:1px solid #e6dcd1;width:100%}
    .flex{display:flex;gap:8px;align-items:center}
    .col{flex:1}
    .note{font-size:13px;color:#7a6a60;margin-top:8px}
    .link{color:var(--accent-2);text-decoration:underline;cursor:pointer}
    pre{background:#fff;padding:8px;border-radius:8px;border:1px solid #eee;overflow:auto}
    footer{padding:20px;text-align:center;color:#8b6f5a;font-size:13px}
    .admin-badge{background:#222;color:#fff;padding:6px 8px;border-radius:8px;font-weight:700}
    .small-btn{padding:6px 8px;border-radius:8px;border:none;cursor:pointer}
    .danger{background:#c0392b;color:#fff}
    @media(max-width:600px){ header{flex-wrap:wrap} .actions{width:100%;justify-content:space-between} .flex{flex-direction:column;align-items:stretch} }
  </style>
</head>
<body>
<header>
  <div class="brand">SRK Pickles</div>
  <nav>
    <button id="nav-shop">Shop</button>
    <button id="nav-orders">My Orders</button>
    <button id="nav-admin">Admin</button>
  </nav>
  <div class="actions">
    <div class="muted">WhatsApp: <a href="https://wa.me/917075535180" target="_blank">+91 70755 35180</a></div>
    <button class="btn" id="btn-open-cart">Cart</button>
  </div>
</header>

<main id="main">
  <!-- SHOP SECTION -->
  <section id="shop-section" class="card">
    <h2>Shop Pickles</h2>
    <p class="muted">Add items to cart and place an order. Orders will be saved locally and also sent to Google Sheets (if you configure the webhook URL below). Admin can update order statuses and trigger notifications.</p>
    <div id="products" class="orders-grid"></div>
  </section>

  <!-- ORDERS / CUSTOMER LOOKUP -->
  <section id="orders-section" class="card" style="display:none;">
    <h2>My Orders</h2>
    <p class="muted">Enter the phone number you used when placing the order to view history and tracking updates.</p>
    <div class="flex" style="margin-top:8px;">
      <input type="tel" id="lookup-phone" placeholder="Enter phone number (e.g., 7075535180)" />
      <button class="btn" id="lookup-btn">Lookup</button>
    </div>
    <div id="orders-list" style="margin-top:12px;"></div>
    <div class="note">To receive real-time SMS/WhatsApp notifications, configure a server or use the NOTIFY webhook below.</div>
  </section>

  <!-- ADMIN SECTION -->
  <section id="admin-section" class="card" style="display:none;">
    <h2>Admin Console <span class="admin-badge">Admin</span></h2>
    <p class="muted">Use admin console to view all orders, update status, sync to Google Sheets, and send notifications (SMS/WhatsApp) via a server webhook.</p>

    <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;align-items:center">
      <div style="flex:1;min-width:220px">
        <label>Admin Password</label>
        <input type="password" id="admin-password" placeholder="Enter admin password" />
      </div>
      <div>
        <button id="admin-login" class="btn">Login</button>
        <button id="admin-logout" class="btn secondary" style="display:none">Logout</button>
      </div>
    </div>

    <div style="margin-top:10px;">
      <label>Google Sheets Webhook URL (POST)</label>
      <input type="text" id="sheets-webhook" placeholder="https://script.google.com/macros/s/XXXX/exec" />
      <div class="muted">When set, new orders and status updates will be POSTed here as JSON.</div>
    </div>

    <div style="margin-top:10px;">
      <label>Notification Webhook URL (server)</label>
      <input type="text" id="notify-webhook" placeholder="https://your-server.example.com/notify" />
      <div class="muted">When set, admin-triggered notifications (SMS/WhatsApp) will POST order details to this URL. Your server should accept JSON and send messages via Twilio/WhatsApp Business API or other providers.</div>
    </div>

    <div style="margin-top:12px;">
      <button id="btn-refresh-orders" class="btn">Refresh Orders</button>
      <button id="btn-sync-all" class="btn secondary">Sync All to Sheets</button>
    </div>

    <h3 style="margin-top:12px">Orders</h3>
    <div id="admin-orders" style="margin-top:8px"></div>

    <div style="margin-top:12px" class="note">
      <strong>Important:</strong> This demo assumes your Google Apps Script or server handles incoming POSTs. Do not paste secrets here in public environments. For production, implement server-side auth.
    </div>
  </section>
</main>

<footer>© SRK Pickles • Demo implementation. Orders can be synced to Google Sheets and notifications sent through your server via webhooks.</footer>

<script>
/* ================== CONFIG & HELPERS ================== */

/*
  HOW TO USE (quick):
  1. Configure a Google Apps Script web app that accepts POST requests and writes the order JSON to Google Sheets.
     - Provide that URL in the Admin → Google Sheets Webhook URL input.
     - When orders are placed they will be POSTed to this webhook automatically (if set).
  2. Create a minimal server endpoint (NOTIFY webhook) which accepts POST requests with JSON { phone, message, method } and sends SMS/WhatsApp via Twilio or WhatsApp Business API.
     - Provide that URL in Admin → Notification Webhook URL.
     - When admin updates order status, the UI will POST to this webhook to trigger notifications.
  3. Admin can also manually press "Send Notification" per order which will call the NOTIFY webhook. If NOTIFY webhook is not configured, the UI will fallback to opening a WhatsApp prefilled message using wa.me (manual user send).
*/

const ORDERS_KEY = "srk_orders_production_v1"; // local storage key (for demo & local backup)
let CART = [];
let IS_ADMIN = false;
const ADMIN_PASSWORD = "admin123"; // change this; for real deployments use server-side auth

/* ======= PRODUCTS ======= */
const PRODUCTS = [
  { id: "mango-garlic", name: "Mango Pickle (With Garlic)", price500: 350, price1000: 700 },
  { id: "gongura", name: "Gongura Pickle", price500: 350, price1000: 700 },
  { id: "bellam-avakaya", name: "Bellam Avakaya", price500: 400, price1000: 800 }
];

/* ======= UI: Render Products ======= */
function renderProducts(){
  const el = document.getElementById("products"); el.innerHTML = "";
  PRODUCTS.forEach(p => {
    const row = document.createElement("div"); row.className = "order-row";
    row.innerHTML = `
      <div style="display:flex;gap:12px;align-items:center">
        <div style="flex:1">
          <div style="font-weight:700">${p.name}</div>
          <div class="small muted">500g: Rs.${p.price500} • 1kg: Rs.${p.price1000}</div>
        </div>
        <div style="width:220px">
          <div style="display:flex;gap:6px;margin-bottom:6px">
            <select data-pid="${p.id}" class="size-select" style="flex:1;padding:8px;border-radius:8px;border:1px solid #e6dcd1">
              <option value="500">500g</option>
              <option value="1000">1kg</option>
            </select>
            <input type="number" min="1" value="1" class="qty-input" style="width:70px;padding:8px;border-radius:8px;border:1px solid #e6dcd1" />
          </div>
          <div style="display:flex;gap:6px">
            <button class="btn add-btn" data-id="${p.id}">Add to cart</button>
            <button class="btn secondary buy-now" data-id="${p.id}">Buy now</button>
          </div>
        </div>
      </div>
    `;
    el.appendChild(row);
  });

  document.querySelectorAll(".add-btn").forEach(b => b.addEventListener("click", e => {
    const id = e.currentTarget.getAttribute("data-id");
    const container = e.currentTarget.closest(".order-row");
    const size = container.querySelector(".size-select").value;
    const qty = parseInt(container.querySelector(".qty-input").value,10) || 1;
    const prod = PRODUCTS.find(x => x.id === id);
    const unit = size === "500" ? prod.price500 : prod.price1000;
    CART.push({ id: id, name: prod.name, size: size, qty: qty, unitPrice: unit });
    alert("Added to cart: " + prod.name);
  }));

  document.querySelectorAll(".buy-now").forEach(b => b.addEventListener("click", e => {
    const id = e.currentTarget.getAttribute("data-id");
    const container = e.currentTarget.closest(".order-row");
    const size = container.querySelector(".size-select").value;
    const qty = parseInt(container.querySelector(".qty-input").value,10) || 1;
    const prod = PRODUCTS.find(x => x.id === id);
    const unit = size === "500" ? prod.price500 : prod.price1000;
    const tempCart = [{ id: id, name: prod.name, size: size, qty: qty, unitPrice: unit }];
    openCheckoutModal(tempCart);
  }));
}

/* ======= Checkout flow ======= */
function openCheckoutModal(cartForCheckout){
  const name = prompt("Enter name for order:");
  if(!name) return alert("Order cancelled");
  const phone = prompt("Enter phone number (used to track order):");
  if(!phone) return alert("Order cancelled");
  const addr = prompt("Enter delivery address:");
  if(!addr) return alert("Order cancelled");
  let subtotal = 0; cartForCheckout.forEach(i=> subtotal += i.unitPrice * i.qty);
  const delivery = subtotal >= 1200 ? 0 : 80;
  const order = {
    id: "SRK" + Date.now().toString().slice(-6),
    name, phone, addr, items: cartForCheckout, subtotal, delivery,
    total: subtotal + delivery, createdAt: new Date().toISOString(),
    statusHistory: [{ status: "Order Placed", time: new Date().toISOString() }]
  };
  saveOrderLocal(order);
  // send to Google Sheets webhook if configured
  postOrderToSheets(order);
  // open WhatsApp with prefilled message so owner gets order notification too
  const summary = cartForCheckout.map(i => `${i.name} (${i.size}) x${i.qty} = Rs.${i.unitPrice*i.qty}`).join("%0A");
  const msg = `New SRK Pickles Order%0A%0AName: ${encodeURIComponent(name)}%0APhone: ${encodeURIComponent(phone)}%0AAddress: ${encodeURIComponent(addr)}%0A%0AItems:%0A${summary}%0A%0ATotal: Rs.${order.total}`;
  window.open("https://wa.me/917075535180?text=" + msg, "_blank");
  alert("Order placed! Your Order ID: " + order.id + ". Use My Orders → Lookup to view tracking updates.");
  // simulate background progress for demo
  simulateOrderProgress(order.id);
}

/* ======= Local storage order helpers ======= */
function getStoredOrders(){ try{ return JSON.parse(localStorage.getItem(ORDERS_KEY)||"[]"); }catch(e){ return []; } }
function saveOrderLocal(order){ const arr=getStoredOrders(); arr.unshift(order); localStorage.setItem(ORDERS_KEY, JSON.stringify(arr)); }
function updateStoredOrder(updated){ const arr=getStoredOrders(); const idx=arr.findIndex(o=>o.id===updated.id); if(idx>=0){ arr[idx]=updated; localStorage.setItem(ORDERS_KEY, JSON.stringify(arr)); } }
function findOrdersByPhone(phone){ if(!phone) return []; const arr=getStoredOrders(); const pnorm = phone.replace(/\D/g,""); return arr.filter(o => (o.phone||"").replace(/\D/g,"").endsWith(pnorm)); }

/* ======= Rendering orders for customers ======= */
function renderOrdersListForPhone(phone){ const container=document.getElementById("orders-list"); container.innerHTML=""; const list=findOrdersByPhone(phone||""); if(!list.length){ container.innerHTML="<div class='muted'>No orders found for this number.</div>"; return; } list.forEach(order => {
  const div=document.createElement("div"); div.className="order-row";
  div.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div><div class="order-id">Order: ${order.id}</div><div class="small muted">Placed: ${new Date(order.createdAt).toLocaleString()}</div></div>
      <div style="text-align:right"><div style="font-weight:800">Rs.${order.total}</div><div class="small muted">${order.items.length} item(s)</div></div>
    </div>
    <div style="margin-top:8px">${order.items.map(it=>`<div class="small">${it.name} • ${it.size} • x${it.qty} • Rs.${it.unitPrice*it.qty}</div>`).join("")}</div>
    <div class="timeline" id="timeline-${order.id}"></div>
    <div style="margin-top:8px;display:flex;gap:8px;justify-content:flex-end"><button class="btn secondary" onclick="showTrackingLink('${order.id}')">Courier Link</button> <button class="btn" onclick="copyOrderId('${order.id}')">Copy Order ID</button></div>
  `;
  container.appendChild(div);
  renderOrderTimeline(order);
}); }

function renderOrderTimeline(order){ const t=document.getElementById("timeline-"+order.id); if(!t) return; t.innerHTML=""; const history=order.statusHistory||[]; history.forEach(h=>{ const span=document.createElement("div"); span.className="status-pill "+statusClass(h.status); span.innerHTML=`<strong>${h.status}</strong><div class="small" style="margin-top:4px">${new Date(h.time).toLocaleString()}</div>`; t.appendChild(span); }); }

function statusClass(status){ if(status==="Order Placed") return "status-placed"; if(status==="Packed") return "status-packed"; if(status==="Shipped") return "status-shipped"; if(status==="Out for Delivery") return "status-otd"; if(status==="Delivered") return "status-delivered"; return ""; }

/* ======= Simulate progress for demo (local only) ======= */
function simulateOrderProgress(orderId){ const steps=["Packed","Shipped","Out for Delivery","Delivered"]; let delay=4000; steps.forEach((s,idx)=>{ setTimeout(()=>{ const arr=getStoredOrders(); const order=arr.find(o=>o.id===orderId); if(!order) return; order.statusHistory.push({ status: s, time: new Date().toISOString() }); localStorage.setItem(ORDERS_KEY, JSON.stringify(arr)); // re-render if visible const lookupPhone=document.getElementById("lookup-phone").value||""; if(lookupPhone && findOrdersByPhone(lookupPhone).some(o=>o.id===orderId)){ renderOrdersListForPhone(lookupPhone); } // post status update to sheets (if configured) postStatusUpdateToSheets(order); // optionally notify via webhook notifyOnStatusChange(order, s); }, delay*(idx+1)); }); }

/* ======= COPY & TRACKING HELPERS ======= */
function showTrackingLink(orderId){ const url = "https://www.example-courier.com/track?order=" + encodeURIComponent(orderId); window.open(url, "_blank"); }
function copyOrderId(id){ navigator.clipboard && navigator.clipboard.writeText(id); alert("Order ID copied: " + id); }

/* ======= Google Sheets & Notification Webhook Integration ======= */

/*
  POST payloads:
  - New Order: POST JSON { type: "new_order", order: { ... } }
  - Status Update: POST JSON { type: "status_update", orderId: "SRK...", status: "Packed", order: { ... } }
  - Notification Request: POST JSON { type: "notify", orderId, phone, message, method }
*/

async function postJson(url, payload){
  if(!url) return { ok:false, error:"no-url" };
  try{
    const res = await fetch(url, { method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify(payload) });
    const txt = await res.text();
    return { ok: res.ok, status: res.status, text: txt };
  }catch(e){
    return { ok:false, error: e.message };
  }
}

function postOrderToSheets(order){
  const sheetsUrl = document.getElementById("sheets-webhook").value.trim();
  if(!sheetsUrl) return;
  const payload = { type: "new_order", order };
  postJson(sheetsUrl, payload).then(r=>{ if(!r.ok) console.warn("Sheets webhook returned", r); else console.log("Posted order to sheets"); });
}

function postStatusUpdateToSheets(order){
  const sheetsUrl = document.getElementById("sheets-webhook").value.trim();
  if(!sheetsUrl) return;
  const payload = { type: "status_update", orderId: order.id, status: order.statusHistory[order.statusHistory.length-1].status, order };
  postJson(sheetsUrl, payload).then(r=>{ if(!r.ok) console.warn("Sheets webhook status returned", r); else console.log("Posted status update to sheets"); });
}

function notifyOnStatusChange(order, status){
  const notifyUrl = document.getElementById("notify-webhook").value.trim();
  const phone = order.phone;
  const message = `Your SRK Pickles order ${order.id} status: ${status}. Thank you!`;
  if(notifyUrl){
    const payload = { type: "notify", orderId: order.id, phone, message, method: "whatsapp_or_sms" };
    postJson(notifyUrl, payload).then(r=>{ if(!r.ok) alert("Notify webhook failed: "+(r.error||r.text)); else console.log("Notify request sent"); });
    return;
  }
  // fallback: open WhatsApp prefilled message for manual send by merchant
  const wa = `https://wa.me/${phone.replace(/\D/g,"")}?text=${encodeURIComponent(message)}`;
  window.open(wa, "_blank");
}

/* ======= Admin: Rendering & Actions ======= */
function renderAdminOrders(){
  const container = document.getElementById("admin-orders"); container.innerHTML = "";
  const arr = getStoredOrders();
  if(!arr.length){ container.innerHTML = "<div class='muted'>No orders yet.</div>"; return; }
  arr.forEach(order => {
    const div = document.createElement("div"); div.className = "order-row";
    div.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><div class="order-id">${order.id}</div><div class="small muted">Placed: ${new Date(order.createdAt).toLocaleString()}</div></div>
        <div style="text-align:right"><div style="font-weight:800">Rs.${order.total}</div><div class="small muted">${order.items.length} item(s)</div></div>
      </div>
      <div style="margin-top:8px">${order.items.map(it=>`<div class="small">${it.name} • ${it.size} • x${it.qty} • Rs.${it.unitPrice*it.qty}</div>`).join("")}</div>
      <div class="timeline" id="admin-timeline-${order.id}"></div>
      <div style="margin-top:8px;display:flex;gap:8px;justify-content:flex-end;align-items:center">
        <select id="status-select-${order.id}" class="small-btn">
          <option value="">-- Update status --</option>
          <option value="Packed">Packed</option>
          <option value="Shipped">Shipped</option>
          <option value="Out for Delivery">Out for Delivery</option>
          <option value="Delivered">Delivered</option>
        </select>
        <button class="small-btn" onclick="adminUpdateStatus('${order.id}')">Update</button>
        <button class="small-btn" onclick="adminSendNotification('${order.id}')">Send Notification</button>
        <button class="small-btn danger" onclick="adminDeleteOrder('${order.id}')">Delete</button>
      </div>
    `;
    container.appendChild(div);
    renderAdminOrderTimeline(order);
  });
}

function renderAdminOrderTimeline(order){
  const t = document.getElementById("admin-timeline-"+order.id); if(!t) return; t.innerHTML = ""; (order.statusHistory||[]).forEach(h=>{ const span=document.createElement("div"); span.className = "status-pill "+statusClass(h.status); span.innerHTML = `<strong>${h.status}</strong><div class="small" style="margin-top:4px">${new Date(h.time).toLocaleString()}</div>`; t.appendChild(span); });
}

function adminUpdateStatus(orderId){
  const sel = document.getElementById("status-select-"+orderId); if(!sel) return; const status = sel.value; if(!status) return alert("Select status"); const arr = getStoredOrders(); const order = arr.find(o=>o.id===orderId); if(!order) return alert("Order not found"); order.statusHistory.push({ status, time: new Date().toISOString() }); updateStoredOrder(order); renderAdminOrders(); renderOrdersListForPhone(document.getElementById("lookup-phone").value||""); postStatusUpdateToSheets(order); notifyOnStatusChange(order, status); alert("Status updated to "+status); }

function adminSendNotification(orderId){
  const arr = getStoredOrders(); const order = arr.find(o=>o.id===orderId); if(!order) return alert("Order not found"); const phone = order.phone; const message = prompt("Message to send to customer (leave blank for default):", `Your SRK Pickles order ${order.id} status: ${order.statusHistory[order.statusHistory.length-1].status}. Thank you!`); if(message===null) return; const notifyUrl = document.getElementById("notify-webhook").value.trim(); if(notifyUrl){ const payload = { type:"notify", orderId: order.id, phone, message, method:"manual" }; postJson(notifyUrl, payload).then(r=>{ if(!r.ok) alert("Notify webhook failed: "+(r.error||r.text)); else alert("Notify request sent"); }); } else { const wa = `https://wa.me/${phone.replace(/\D/g,"")}?text=${encodeURIComponent(message)}`; window.open(wa, "_blank"); } }

function adminDeleteOrder(orderId){ if(!confirm("Delete order "+orderId+"? This cannot be undone locally.")) return; let arr=getStoredOrders(); arr = arr.filter(o=>o.id!==orderId); localStorage.setItem(ORDERS_KEY, JSON.stringify(arr)); renderAdminOrders(); alert("Order deleted locally."); }

/* ======= Admin login flow ======= */
document.getElementById("admin-login").addEventListener("click", function(){ const pw = document.getElementById("admin-password").value; if(pw===ADMIN_PASSWORD){ IS_ADMIN=true; document.getElementById("admin-login").style.display="none"; document.getElementById("admin-logout").style.display="inline-block"; document.getElementById("admin-password").disabled=true; renderAdminOrders(); alert("Admin access granted."); } else alert("Invalid password."); });
document.getElementById("admin-logout").addEventListener("click", function(){ IS_ADMIN=false; document.getElementById("admin-login").style.display="inline-block"; document.getElementById("admin-logout").style.display="none"; document.getElementById("admin-password").disabled=false; document.getElementById("admin-password").value=""; document.getElementById("admin-orders").innerHTML=""; });

/* ======= Sync all orders to sheets (admin) ======= */
document.getElementById("btn-sync-all").addEventListener("click", function(){ if(!IS_ADMIN) return alert("Admin only"); const url=document.getElementById("sheets-webhook").value.trim(); if(!url) return alert("Set Google Sheets webhook URL first"); const arr=getStoredOrders(); if(!arr.length) return alert("No orders to sync"); // send them sequentially
  (async ()=>{ for(const o of arr){ await postJson(url, { type:"new_order", order:o }); } alert("Sync requests sent (check server response in console)."); })(); });

/* ======= Refresh admin orders ======= */
document.getElementById("btn-refresh-orders").addEventListener("click", function(){ if(!IS_ADMIN) return alert("Admin only"); renderAdminOrders(); });

/* ======= Customer lookup ======= */
document.getElementById("lookup-btn").addEventListener("click", function(){ const phone=(document.getElementById("lookup-phone").value||"").trim(); if(!phone) return alert("Enter phone number"); renderOrdersListForPhone(phone); });

/* ======= Cart button checkout ======= */
document.getElementById("btn-open-cart").addEventListener("click", function(){ if(!CART.length) return alert("Cart is empty. Add items first."); openCheckoutModal(CART); CART=[]; });

/* ======= Init ======= */
renderProducts();

// Pre-seed demo order (if no orders exist)
if(!getStoredOrders().length){
  const sample = {
    id: "SRK" + (Math.floor(Math.random()*900000)+100000),
    name: "Demo User",
    phone: "7075535180",
    addr: "Demo Address",
    items: [{ id:"mango-garlic", name:"Mango Pickle (With Garlic)", size:"500", qty:1, unitPrice:350 }],
    subtotal:350, delivery:80, total:430, createdAt:new Date().toISOString(),
    statusHistory:[{ status:"Order Placed", time: new Date().toISOString() }]
  };
  saveOrderLocal(sample);
  setTimeout(()=>simulateOrderProgress(sample.id), 2500);
}

</script>
</body>
</html>
